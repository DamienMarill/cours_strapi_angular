<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≠ Tutoriel Backend Directus - Projet Meme Manager</title>
    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --border-color: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background: var(--light-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .toc {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .toc h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .toc ol {
            list-style: none;
            counter-reset: section;
        }

        .toc li {
            counter-increment: section;
            margin-bottom: 0.5rem;
        }

        .toc li::before {
            content: counter(section) ". ";
            color: var(--primary-color);
            font-weight: 600;
        }

        .toc a {
            color: var(--dark-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        .toc a:hover {
            color: var(--primary-color);
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 1.5rem;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }

        h3 {
            color: var(--secondary-color);
            font-size: 1.5rem;
            margin: 2rem 0 1rem 0;
        }

        h4 {
            color: var(--dark-color);
            font-size: 1.2rem;
            margin: 1.5rem 0 1rem 0;
            font-weight: 600;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border-left: 4px solid;
        }

        .alert.info {
            background-color: #dbeafe;
            border-color: var(--info-color);
            color: #1e40af;
        }

        .alert.warning {
            background-color: #fef3c7;
            border-color: var(--warning-color);
            color: #92400e;
        }

        .alert.success {
            background-color: #d1fae5;
            border-color: var(--success-color);
            color: #065f46;
        }

        .alert.danger {
            background-color: #fee2e2;
            border-color: var(--danger-color);
            color: #991b1b;
        }

        .alert strong {
            display: block;
            margin-bottom: 0.5rem;
        }

        code {
            background: #f3f4f6;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
        }

        pre {
            background: var(--dark-color);
            color: #e5e7eb;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
        }

        pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        .code-block {
            position: relative;
            margin: 1.5rem 0;
        }

        .code-header {
            background: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px 8px 0 0;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .code-header + pre {
            margin-top: 0;
            border-radius: 0 0 8px 8px;
        }

        .checklist {
            list-style: none;
            padding-left: 0;
        }

        .checklist li {
            margin: 0.5rem 0;
            display: flex;
            align-items: center;
        }

        .checklist li::before {
            content: "‚úÖ";
            margin-right: 0.5rem;
            font-size: 1.1rem;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .feature-card {
            background: #f8fafc;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.1);
        }

        .feature-card h4 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .diagram {
            background: white;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin: 1.5rem 0;
            color: #6b7280;
            font-style: italic;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-right: 0.5rem;
        }

        .badge.new {
            background: var(--success-color);
            color: white;
        }

        .badge.advanced {
            background: var(--warning-color);
            color: white;
        }

        .badge.bonus {
            background: var(--info-color);
            color: white;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem 0;
            border-top: 1px solid var(--border-color);
            margin-top: 3rem;
        }

        .nav-button {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .nav-button:hover {
            background: #3730a3;
        }

        .nav-button.disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        footer {
            background: var(--dark-color);
            color: white;
            padding: 3rem 0;
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h3 {
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section li {
            margin-bottom: 0.5rem;
        }

        .footer-section a {
            color: #d1d5db;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-section a:hover {
            color: var(--secondary-color);
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }

            header h1 {
                font-size: 2rem;
            }

            .section {
                padding: 1.5rem;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üé≠ Tutoriel Backend Directus</h1>
            <p>Projet Meme Manager - Guide complet pour cr√©er une API moderne</p>
        </div>
    </header>

    <main class="container">
        <div class="toc">
            <h2>üìã Table des Mati√®res</h2>
            <ol>
                <li><a href="#introduction">Introduction √† Directus</a></li>
                <li><a href="#architecture">Architecture du projet</a></li>
                <li><a href="#configuration">Configuration initiale</a></li>
                <li><a href="#collections">Cr√©ation des collections</a></li>
                <li><a href="#relations">Relations entre collections</a></li>
                <li><a href="#medias">Gestion des m√©dias</a></li>
                <li><a href="#permissions">Configuration des r√¥les et permissions</a></li>
                <li><a href="#api">API et int√©gration</a></li>
                <li><a href="#tests">Tests et validation</a></li>
                <li><a href="#oauth">Configuration OAuth GitHub <span class="badge bonus">Bonus</span></a></li>
                <li><a href="#meilisearch">Recherche intelligente <span class="badge advanced">Avanc√©</span></a></li>
                <li><a href="#websockets">WebSockets temps r√©el <span class="badge advanced">Avanc√©</span></a></li>
            </ol>
        </div>

        <section id="introduction" class="section">
            <h2>1. Introduction √† Directus</h2>
            
            <h3>Qu'est-ce que Directus ?</h3>
            <p>Directus est un <strong>headless CMS</strong> (Content Management System) moderne qui transforme n'importe quelle base de donn√©es SQL en une API REST/GraphQL compl√®te avec une interface d'administration intuitive.</p>

            <h4>Concepts cl√©s :</h4>
            <ul>
                <li><strong>Database-first</strong> : Directus s'adapte √† votre sch√©ma de base de donn√©es existant</li>
                <li><strong>Headless</strong> : S√©pare le backend (gestion des donn√©es) du frontend (interface utilisateur)</li>
                <li><strong>API-first</strong> : G√©n√®re automatiquement des APIs REST et GraphQL</li>
                <li><strong>No vendor lock-in</strong> : Vos donn√©es restent dans une base SQL standard</li>
            </ul>

            <h3>Avantages pour notre projet Meme Manager</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üñºÔ∏è Gestion automatique des m√©dias</h4>
                    <p>Upload, transformations et optimisation d'images automatiques</p>
                </div>
                <div class="feature-card">
                    <h4>‚öôÔ∏è Interface d'administration</h4>
                    <p>Interface cl√© en main pour g√©rer le contenu</p>
                </div>
                <div class="feature-card">
                    <h4>üîå API REST/GraphQL</h4>
                    <p>APIs g√©n√©r√©es automatiquement selon votre mod√®le</p>
                </div>
                <div class="feature-card">
                    <h4>üîí Syst√®me de permissions</h4>
                    <p>Contr√¥le granulaire des acc√®s et permissions</p>
                </div>
                <div class="feature-card">
                    <h4>üì¶ TypeScript SDK</h4>
                    <p>Client typ√© pour l'int√©gration Angular</p>
                </div>
                <div class="feature-card">
                    <h4>üöÄ Pr√™t pour la production</h4>
                    <p>Scalable et optimis√© pour les applications modernes</p>
                </div>
            </div>

            <div class="diagram">
                [Ins√©rer screenshot : Interface d'administration Directus]
            </div>
        </section>

        <section id="architecture" class="section">
            <h2>2. Architecture du projet</h2>
            
            <div class="alert info">
                <strong>üìÅ Note pour les √©tudiants :</strong>
                Si vous choisissez le projet UTAU Editor, r√©f√©rez-vous au fichier <code>tutoriel-directus-utau-editor.md</code> pour cette section. L'architecture pr√©sent√©e ici est sp√©cifique au Meme Manager.
            </div>

            <h3>Structure de donn√©es du Meme Manager</h3>
            <p>Notre application va g√©rer :</p>

            <div class="code-block">
                <div class="code-header">Structure hi√©rarchique</div>
                <pre><code>üë§ Utilisateurs (Users) - SYST√àME DIRECTUS INT√âGR√â
‚îú‚îÄ‚îÄ üé≠ Memes cr√©√©s
‚îú‚îÄ‚îÄ ‚ù§Ô∏è Memes lik√©s  
‚îú‚îÄ‚îÄ üë§ Profil (nom, email, avatar)
‚îî‚îÄ‚îÄ üîê Authentification

üé≠ Memes
‚îú‚îÄ‚îÄ üñºÔ∏è Image de base
‚îú‚îÄ‚îÄ üè∑Ô∏è Tags (multiples)
‚îú‚îÄ‚îÄ üë§ Cr√©ateur (utilisateur connect√©)
‚îú‚îÄ‚îÄ üìä Statistiques (vues, likes)
‚îî‚îÄ‚îÄ ‚ù§Ô∏è Liste des utilisateurs qui ont lik√©

üè∑Ô∏è Tags
‚îî‚îÄ‚îÄ üìõ Nom

üîî Notifications (Syst√®me temps r√©el)
‚îú‚îÄ‚îÄ üë§ Utilisateur destinataire
‚îú‚îÄ‚îÄ üìù Message de notification
‚îú‚îÄ‚îÄ üé≠ Meme associ√© (optionnel)
‚îú‚îÄ‚îÄ üîÑ Type d'√©v√©nement (nouveau_meme, nouveau_like, nouveau_tag)
‚îú‚îÄ‚îÄ ‚úÖ Statut (lu/non_lu)
‚îî‚îÄ‚îÄ üìÖ Date de cr√©ation</code></pre>
            </div>

            <h3>Mod√®le Conceptuel de Donn√©es (MCD)</h3>
            <div class="diagram">
                [Diagramme Mermaid du MCD - Relations entre DIRECTUS_USERS, MEMES, TAGS, MEMES_LIKES, NOTIFICATIONS et DIRECTUS_FILES]
            </div>

            <h4>Relations et Cardinalit√©s</h4>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>1Ô∏è‚É£ USERS ‚Üí MEMES (1:N)</h4>
                    <p>Un utilisateur peut cr√©er plusieurs memes. Un meme a un seul cr√©ateur.</p>
                </div>
                <div class="feature-card">
                    <h4>2Ô∏è‚É£ MEMES ‚Üí TAGS (N:M)</h4>
                    <p>Un meme peut avoir plusieurs tags. Un tag peut √™tre utilis√© par plusieurs memes.</p>
                </div>
                <div class="feature-card">
                    <h4>3Ô∏è‚É£ USERS ‚Üí MEMES (N:M)</h4>
                    <p>Syst√®me de likes : un utilisateur peut liker plusieurs memes.</p>
                </div>
                <div class="feature-card">
                    <h4>4Ô∏è‚É£ MEMES ‚Üí FILES (N:1)</h4>
                    <p>Un meme utilise une image principale stock√©e dans directus_files.</p>
                </div>
            </div>

            <h3>Syst√®me d'utilisateurs Directus int√©gr√©</h3>
            <div class="alert success">
                <strong>üîë Collection directus_users pr√©-existante</strong>
                Directus inclut par d√©faut un syst√®me complet de gestion des utilisateurs avec authentification classique ET OAuth (GitHub, Google, etc.).
            </div>

            <h4>Champs principaux disponibles :</h4>
            <ul class="checklist">
                <li><code>id</code> : UUID unique de l'utilisateur</li>
                <li><code>first_name / last_name</code> : Nom et pr√©nom</li>
                <li><code>email</code> : Email unique (utilis√© pour la connexion)</li>
                <li><code>password</code> : Mot de passe hash√© automatiquement</li>
                <li><code>avatar</code> : Photo de profil (relation vers directus_files)</li>
                <li><code>provider</code> : M√©thode de connexion (default/github/google)</li>
            </ul>

            <h4>Avantages du syst√®me int√©gr√© :</h4>
            <ul class="checklist">
                <li>Authentification JWT automatique</li>
                <li>Hash des mots de passe s√©curis√©</li>
                <li>Validation email int√©gr√©e</li>
                <li>Syst√®me de r√¥les et permissions</li>
                <li>API d'authentification pr√™te √† l'emploi</li>
                <li>Interface admin pour g√©rer les utilisateurs</li>
            </ul>
        </section>

        <section id="configuration" class="section">
            <h2>3. Configuration initiale</h2>

            <h3>Pr√©requis techniques</h3>
            <ul class="checklist">
                <li>Node.js >= 18.13.0</li>
                <li>npm >= 9.0.0</li>
                <li>Git</li>
            </ul>

            <h3>√âtape 1 : Initialisation rapide avec le CLI Directus</h3>
            <div class="alert info">
                <strong>üí° La m√©thode moderne et simple</strong>
                Nous utiliserons le CLI officiel Directus pour cr√©er automatiquement la structure du projet.
            </div>

            <div class="code-block">
                <div class="code-header">Commandes d'initialisation</div>
                <pre><code># Cr√©er un nouveau dossier qui contiendra votre projet
mkdir mon-projet-meme-manager

# Naviguer dans le dossier cr√©√©
cd mon-projet-meme-manager

# Initialiser un projet Directus
npm init directus-projet@latest .</code></pre>
            </div>

            <p>Cette commande va automatiquement :</p>
            <ul class="checklist">
                <li>Cr√©er la structure de fichiers</li>
                <li>Installer toutes les d√©pendances</li>
                <li>Configurer le fichier .env avec des valeurs par d√©faut</li>
                <li>Pr√©parer les scripts npm</li>
            </ul>

            <div class="alert warning">
                <strong>‚öôÔ∏è Configuration lors de l'ex√©cution</strong>
                Le CLI vous posera quelques questions pour personnaliser votre projet :
                <ul>
                    <li>Database client : <strong>SQLite</strong></li>
                    <li>Database file path : <strong>./data/database.db</strong></li>
                    <li>Admin email : <strong>ton-email@example.com</strong></li>
                    <li>Admin password : <strong>ton-mot-de-passe</strong></li>
                </ul>
            </div>

            <h3>√âtape 2 : Initialisation Git</h3>
            <div class="code-block">
                <div class="code-header">Configuration Git</div>
                <pre><code># Cr√©er un fichier .gitignore
cat > .gitignore << EOF
node_modules/
.env
data.db
uploads/

.vscode/
.DS_Store
.idea/
EOF

# Initialiser le d√©p√¥t Git
git init
git add .
git commit -m "Initial commit - Setup Directus project"</code></pre>
            </div>

            <h3>√âtape 3 : Premier d√©marrage</h3>
            <div class="code-block">
                <div class="code-header">Lancement du serveur</div>
                <pre><code># D√©marrer Directus en mode d√©veloppement
npx directus start</code></pre>
            </div>

            <h3>V√©rification de l'installation</h3>
            <div class="alert success">
                <strong>‚úÖ Checklist de validation</strong>
                V√©rifiez que tous ces points sont valid√©s :
                <ul class="checklist">
                    <li>Directus d√©marre sans erreur</li>
                    <li>Interface accessible sur http://localhost:8055</li>
                    <li>Connexion admin fonctionnelle</li>
                    <li>Base de donn√©es SQLite cr√©√©e automatiquement</li>
                    <li>Structure de fichiers compl√®te</li>
                </ul>
            </div>
        </section>

        <section id="collections" class="section">
            <h2>4. Cr√©ation des collections</h2>

            <div class="alert info">
                <strong>üìö Comprendre les Collections Directus</strong>
                Une <strong>collection</strong> dans Directus = une <strong>table</strong> en base de donn√©es. Chaque collection contient des <strong>champs</strong> (colonnes) avec des <strong>types</strong> sp√©cifiques.
            </div>

            <h3>üè∑Ô∏è √âtape 1 : Cr√©er la collection "Tags"</h3>
            
            <h4>Configuration de base</h4>
            <ol>
                <li>Dans le menu principal ‚Üí <strong>Settings</strong> ‚Üí <strong>Data Model</strong></li>
                <li>Cliquer sur <strong>"Create Collection"</strong></li>
                <li>
                    <strong>Collection Name</strong> : <code>tags</code><br>
                    <strong>Primary key</strong> : <code>id</code> (UUID, auto-g√©n√©r√©)<br>
                    <strong>Cocher</strong> : Created On, Updated On (timestamps automatiques)
                </li>
                <li>Cliquer sur <strong>"Finish Setup"</strong></li>
            </ol>

            <h4>Ajout des champs</h4>
            <div class="feature-card">
                <h4>Champ "name" (Nom du tag)</h4>
                <ul>
                    <li><strong>Type</strong> : String</li>
                    <li><strong>Key</strong> : <code>name</code></li>
                    <li><strong>Required</strong> : ‚úÖ Oui</li>
                    <li><strong>Unique</strong> : ‚úÖ Oui</li>
                </ul>
            </div>

            <h3>üé≠ √âtape 2 : Cr√©er la collection "Memes"</h3>
            
            <h4>Configuration de base</h4>
            <ol>
                <li><strong>Collection Name</strong> : <code>memes</code></li>
                <li><strong>Primary key</strong> : <code>id</code> (UUID, auto-g√©n√©r√©)</li>
                <li><strong>Cocher</strong> : Created On, Updated On et Created By</li>
                <li>Cliquer sur <strong>"Finish Setup"</strong></li>
            </ol>

            <h4>Ajout des champs essentiels</h4>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Champ "title"</h4>
                    <ul>
                        <li><strong>Type</strong> : String</li>
                        <li><strong>Key</strong> : <code>title</code></li>
                        <li><strong>Required</strong> : ‚úÖ Oui</li>
                        <li><strong>Interface</strong> : Input</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>Champ "image"</h4>
                    <ul>
                        <li><strong>Type</strong> : Image</li>
                        <li><strong>Key</strong> : <code>image</code></li>
                        <li><strong>Required</strong> : ‚úÖ Oui</li>
                        <li><strong>Crop to fit</strong> : Non</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>Champ "views"</h4>
                    <ul>
                        <li><strong>Type</strong> : Integer</li>
                        <li><strong>Key</strong> : <code>views</code></li>
                        <li><strong>Default Value</strong> : <code>0</code></li>
                        <li><strong>Interface</strong> : Input</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>Champ "likes"</h4>
                    <ul>
                        <li><strong>Type</strong> : Integer</li>
                        <li><strong>Key</strong> : <code>likes</code></li>
                        <li><strong>Default Value</strong> : <code>0</code></li>
                        <li><strong>Interface</strong> : Input</li>
                    </ul>
                </div>
            </div>

            <div class="alert warning">
                <strong>üìù √Ä faire de m√™me</strong>
                Cr√©ez aussi les collections <code>memes_likes</code> et <code>notifications</code> en suivant le m√™me processus et en vous r√©f√©rant au MCD de la section 2.
            </div>

            <div class="diagram">
                [Ins√©rer screenshots : Interface de cr√©ation des collections dans Directus]
            </div>
        </section>

        <section id="relations" class="section">
            <h2>5. Relations entre collections</h2>

            <h3>Comprendre les relations Directus</h3>
            <p>Les relations permettent de lier les collections entre elles :</p>
            <ul>
                <li><strong>Many-to-One (M2O)</strong> : plusieurs √©l√©ments d'une collection pointent vers un seul √©l√©ment d'une autre collection</li>
                <li><strong>One-to-Many (O2M)</strong> : un √©l√©ment d'une collection est li√© √† plusieurs √©l√©ments d'une autre collection (inverse de M2O)</li>
                <li><strong>Many-to-Many (M2M)</strong> : plusieurs √©l√©ments d'une collection sont li√©s √† plusieurs √©l√©ments d'une autre collection via une table de liaison</li>
            </ul>

            <h3>üîó √âtape 1 : Comprendre les relations avec directus_users</h3>
            <div class="alert info">
                <strong>üîÑ Relations automatiques d√©j√† cr√©√©es</strong>
                <ul>
                    <li><code>user_created</code> : Directus ajoute automatiquement ce champ √† toute collection avec "Accountability" activ√©</li>
                    <li><code>date_created / date_updated</code> : Timestamps automatiques</li>
                    <li>Ces champs se remplissent automatiquement selon l'utilisateur connect√©</li>
                </ul>
            </div>

            <h3>üîó √âtape 2 : Relation Memes ‚Üí Tags (M2M)</h3>
            <ol>
                <li>Aller dans la collection <strong>Memes</strong> ‚Üí Data Model ‚Üí <code>memes</code></li>
                <li>Cliquer sur <strong>"Create Field"</strong></li>
                <li>Configurer le champ de relation :
                    <ul>
                        <li><strong>Type</strong> : Many to Many</li>
                        <li><strong>Key</strong> : <code>tags</code></li>
                        <li><strong>Display Name</strong> : "Tags"</li>
                        <li><strong>Related Collection</strong> : <strong>tags</strong></li>
                        <li><strong>Junction Collection</strong> : <strong>memes_tags</strong> (sera cr√©√©e automatiquement)</li>
                    </ul>
                </li>
            </ol>

            <h3>üîó √âtape 3 : Relations inverses automatiques</h3>
            <div class="alert success">
                <strong>‚ú® Directus cr√©e automatiquement les relations inverses</strong>
                <ul>
                    <li>Dans <code>tags</code> : champ virtuel <code>memes</code> (Many to Many)</li>
                    <li>Dans <code>memes</code> : champ <code>tags</code> permettant la s√©lection multiple</li>
                    <li>Dans <code>directus_users</code> : champ virtuel <code>memes</code> (ses memes cr√©√©s)</li>
                    <li>Dans <code>directus_users</code> : champ virtuel <code>memes_likes</code> (ses likes)</li>
                    <li>Dans <code>memes</code> : champ virtuel <code>memes_likes</code> (qui a lik√© ce meme)</li>
                </ul>
            </div>

            <h3>üîÑ √âtape 4 : Cr√©er une migration du sch√©ma (Recommand√©)</h3>
            <div class="alert warning">
                <strong>üì¶ Pourquoi cr√©er des migrations ?</strong>
                Les <strong>migrations</strong> dans Directus permettent de :
                <ul class="checklist">
                    <li><strong>Versioner votre sch√©ma de base de donn√©es</strong> comme du code</li>
                    <li><strong>Synchroniser</strong> les modifications entre d√©veloppement/production</li>
                    <li><strong>Collaborer en √©quipe</strong> sans conflits de structure</li>
                    <li><strong>Rollback</strong> en cas de probl√®me</li>
                    <li><strong>Documenter</strong> l'√©volution de votre mod√®le de donn√©es</li>
                </ul>
            </div>

            <h4>Cr√©er votre premi√®re migration</h4>
            <div class="code-block">
                <div class="code-header">Via la CLI Directus</div>
                <pre><code># Depuis votre dossier projet
npx directus schema snapshot migrations/001_initial_meme_manager_schema.json</code></pre>
            </div>

            <h4>Workflow recommand√©</h4>
            <div class="code-block">
                <div class="code-header">Cycle de migration</div>
                <pre><code># 1. D√©veloppement : cr√©er votre mod√®le via l'interface
# 2. Cr√©er une migration
npx directus schema snapshot migrations/001_initial_schema.json

# 3. Versionner avec Git
git add migrations/001_initial_schema.json
git commit -m "feat: migration initiale du sch√©ma meme manager"

# 4. En production : appliquer la migration  
npx directus schema apply migrations/001_initial_schema.json</code></pre>
            </div>

            <div class="alert info">
                <strong>üîÑ Points de migration futurs</strong>
                √Ä chaque modification de structure dans ce tutoriel, nous cr√©erons une nouvelle migration :
                <ul>
                    <li>Apr√®s l'ajout des champs OAuth (section 10)</li>
                    <li>Apr√®s l'ajout des extensions Meilisearch (section 11)</li>
                    <li>Avant chaque d√©ploiement en production</li>
                </ul>
            </div>
        </section>

        <section id="medias" class="section">
            <h2>6. Gestion des m√©dias</h2>

            <h3>Configuration du stockage de fichiers</h3>
            <p>Directus g√®re automatiquement l'upload et la transformation des m√©dias. Voici comment optimiser cette fonctionnalit√© pour notre projet.</p>

            <h3>Transformations automatiques d'images</h3>
            <ol>
                <li>Acc√©der aux r√©glages de fichiers ‚Üí Settings ‚Üí Settings ‚Üí <strong>Files & Storage</strong></li>
                <li>Configuration des transformations :
                    <ul>
                        <li><strong>Thumbnail Generation</strong> : ‚úÖ Activ√©</li>
                        <li><strong>Fit</strong> : contain (pour √©viter les d√©coupages)</li>
                        <li><strong>Height</strong> : 1000 (px)</li>
                        <li><strong>Width</strong> : 1000 (px)</li>
                        <li><strong>Quality</strong> : 80 (bon compromis qualit√©/taille)</li>
                        <li><strong>Format</strong> : WebP (pour l'optimisation)</li>
                    </ul>
                </li>
            </ol>

            <h3>Utilisation des transformations dans l'API</h3>
            <p>Directus permet de transformer les images √† la vol√©e via l'URL :</p>

            <div class="code-block">
                <div class="code-header">Exemples de transformations</div>
                <pre><code># Image originale
GET /assets/[file-id]

# Redimensionnement
GET /assets/[file-id]?width=400&height=400

# Format et qualit√©
GET /assets/[file-id]?format=webp&quality=80

# Transformations combin√©es
GET /assets/[file-id]?width=800&height=600&fit=cover&quality=85&format=webp</code></pre>
            </div>

            <div class="diagram">
                [Ins√©rer screenshot : Configuration des transformations dans l'interface Directus]
            </div>
        </section>

        <section id="permissions" class="section">
            <h2>7. Configuration des r√¥les et permissions</h2>

            <h3>Syst√®me de permissions Directus</h3>
            <p>Directus utilise un syst√®me <strong>RBAC</strong> (Role-Based Access Control) :</p>
            <ul>
                <li><strong>R√¥les</strong> : Groupes d'utilisateurs avec des permissions sp√©cifiques</li>
                <li><strong>Permissions</strong> : Actions autoris√©es sur chaque collection</li>
                <li><strong>Politiques</strong> : R√®gles conditionnelles avanc√©es</li>
            </ul>

            <h3>Cr√©ation du r√¥le "Public"</h3>
            <ol>
                <li>Acc√©der √† la gestion des r√¥les ‚Üí Settings ‚Üí <strong>Access Control</strong> ‚Üí <strong>Roles</strong></li>
                <li>Cliquer sur <strong>"Create Role"</strong></li>
                <li>Configuration du r√¥le :
                    <ul>
                        <li><strong>Name</strong> : <code>Public</code></li>
                        <li><strong>Description</strong> : "Acc√®s public en lecture seule"</li>
                        <li><strong>App Access</strong> : ‚ùå D√©sactiv√©</li>
                        <li><strong>Admin Access</strong> : ‚ùå D√©sactiv√©</li>
                    </ul>
                </li>
            </ol>

            <h3>Cr√©ation du r√¥le "Authenticated User"</h3>
            <div class="feature-card">
                <h4>Configuration</h4>
                <ul>
                    <li><strong>Name</strong> : <code>Authenticated User</code></li>
                    <li><strong>Description</strong> : "Utilisateurs connect√©s pouvant cr√©er des memes"</li>
                    <li><strong>App Access</strong> : ‚ùå D√©sactiv√©</li>
                    <li><strong>Admin Access</strong> : ‚ùå D√©sactiv√©</li>
                </ul>
            </div>

            <h3>Configuration des permissions</h3>

            <h4>Collection Memes (Public vs Authenticated)</h4>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üë• R√¥le Public</h4>
                    <ul>
                        <li><strong>Read</strong> : ‚úÖ Tous les items</li>
                        <li><strong>Create</strong> : ‚ùå Aucun</li>
                        <li><strong>Update</strong> : ‚ùå Aucun</li>
                        <li><strong>Delete</strong> : ‚ùå Aucun</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>üîê Utilisateurs authentifi√©s</h4>
                    <ul>
                        <li><strong>Read</strong> : ‚úÖ Tous les items</li>
                        <li><strong>Create</strong> : ‚úÖ Avec r√®gle <code>user_created = $CURRENT_USER</code></li>
                        <li><strong>Update</strong> : ‚úÖ Seulement ses propres memes</li>
                        <li><strong>Delete</strong> : ‚úÖ Seulement ses propres memes</li>
                    </ul>
                </div>
            </div>

            <h4>Collection Memes_Likes (Authenticated User)</h4>
            <div class="feature-card">
                <ul>
                    <li><strong>Read</strong> : ‚úÖ Tous les items</li>
                    <li><strong>Create</strong> : ‚úÖ Avec r√®gle <code>user_id = $CURRENT_USER</code> (pour liker)</li>
                    <li><strong>Delete</strong> : ‚úÖ Seulement ses propres likes</li>
                    <li><strong>Update</strong> : ‚ùå Aucun (pas besoin de modifier un like)</li>
                </ul>
            </div>

            <div class="alert success">
                <strong>üîí S√©curit√© automatique</strong>
                Les r√®gles <code>user_created = $CURRENT_USER</code> et <code>user_id = $CURRENT_USER</code> garantissent que les utilisateurs ne peuvent modifier que leurs propres contenus.
            </div>

            <div class="diagram">
                [Ins√©rer screenshot : Configuration des permissions dans l'interface Directus]
            </div>
        </section>

        <section id="api" class="section">
            <h2>8. API et int√©gration</h2>

            <h3>Types d'API disponibles</h3>
            <p>Directus g√©n√®re automatiquement :</p>
            <ul>
                <li><strong>REST API</strong> : <code>/items/collection-name</code></li>
                <li><strong>GraphQL API</strong> : <code>/graphql</code></li>
                <li><strong>SDK TypeScript</strong> : Client typ√© pour Angular</li>
            </ul>

            <div class="alert info">
                <strong>üìù Note importante</strong>
                Dans cette section, nous utiliserons l'authentification classique email/password pour apprendre les bases. L'authentification OAuth GitHub sera abord√©e plus tard comme fonctionnalit√© avanc√©e une fois que l'API de base sera ma√Ætris√©e.
            </div>

            <h3>Endpoints REST √† tester</h3>

            <h4>üîê 1. Authentification</h4>
            <p><strong>Cr√©er un compte utilisateur via l'interface :</strong></p>
            <ol>
                <li>Acc√©der √† http://localhost:8055</li>
                <li>Se connecter avec le compte admin</li>
                <li>User Directory ‚Üí Create User</li>
                <li>Email: <code>test@example.com</code>, Password: <code>password123</code></li>
                <li>Role: <code>Authenticated User</code></li>
            </ol>

            <div class="code-block">
                <div class="code-header">Connexion via API</div>
                <pre><code>POST http://localhost:8055/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "password123"
}</code></pre>
            </div>

            <div class="code-block">
                <div class="code-header">R√©ponse attendue</div>
                <pre><code>{
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires": 900000,
    "refresh_token": "def50200..."
  }
}</code></pre>
            </div>

            <h4>üìÅ 2. Upload d'image</h4>
            <div class="code-block">
                <div class="code-header">Requ√™te d'upload</div>
                <pre><code>POST http://localhost:8055/files
Authorization: Bearer [access_token]
Content-Type: multipart/form-data

[Fichier image dans le form-data avec key "file"]</code></pre>
            </div>
            <p><strong>R√©ponse :</strong> UUID du fichier upload√© √† utiliser pour les memes</p>

            <h4>üè∑Ô∏è 3. Cr√©ation de tags</h4>
            <div class="code-block">
                <div class="code-header">Cr√©er un tag</div>
                <pre><code>POST http://localhost:8055/items/tags
Authorization: Bearer [access_token]  
Content-Type: application/json

{
  "name": "humor"
}</code></pre>
            </div>
            <p>Cr√©er plusieurs tags : "humor", "programmation", "reaction", "classique"</p>

            <h4>üé≠ 4. Cr√©ation d'un meme</h4>
            <div class="code-block">
                <div class="code-header">Cr√©er un meme avec relations</div>
                <pre><code>POST http://localhost:8055/items/memes
Authorization: Bearer [access_token]
Content-Type: application/json

{
  "title": "Mon premier meme",
  "image": "uuid-du-fichier-upload√©",
  "text_top": "Quand tu debugs",
  "text_bottom": "Et √ßa marche du premier coup",
  "tags": [
    {"tags_id": "uuid-tag-humor"},
    {"tags_id": "uuid-tag-programmation"}
  ]
}</code></pre>
            </div>

            <h4>üìñ 5. Lecture des memes avec relations</h4>
            <div class="code-block">
                <div class="code-header">R√©cup√©rer les memes avec leurs relations</div>
                <pre><code>GET http://localhost:8055/items/memes?fields=*,tags.tags_id.name,user_created.first_name,user_created.last_name</code></pre>
            </div>

            <h4>‚ù§Ô∏è 6. Syst√®me de likes</h4>
            <div class="code-block">
                <div class="code-header">Liker un meme</div>
                <pre><code>POST http://localhost:8055/items/memes_likes
Authorization: Bearer [access_token]
Content-Type: application/json

{
  "meme_id": "uuid-du-meme"
}</code></pre>
            </div>

            <h3>Tests avec Insomnia/Postman</h3>
            <div class="alert success">
                <strong>üîß Outils recommand√©s</strong>
                <ul>
                    <li><strong>Insomnia</strong> : https://insomnia.rest (plus moderne et intuitif)</li>
                    <li><strong>Postman</strong> : https://postman.com (plus populaire et complet)</li>
                </ul>
            </div>

            <h4>Configuration de base</h4>
            <ol>
                <li>Cr√©er un nouveau workspace/collection</li>
                <li><strong>URL de base</strong> : <code>http://localhost:8055</code></li>
                <li><strong>Headers communs</strong> :
                    <div class="code-block">
                        <pre><code>Content-Type: application/json
Accept: application/json</code></pre>
                    </div>
                </li>
            </ol>

            <div class="diagram">
                [Ins√©rer screenshot : Interface Insomnia avec workspace Directus-Memes]
            </div>
        </section>

        <section id="tests" class="section">
            <h2>9. Tests et validation de l'API</h2>

            <h3>Comprendre l'API REST de Directus</h3>
            <p>Directus g√©n√®re automatiquement une <strong>API REST compl√®te</strong> bas√©e sur votre mod√®le de donn√©es. Chaque collection devient un endpoint avec les op√©rations CRUD standard :</p>

            <div class="code-block">
                <div class="code-header">Structure des URLs</div>
                <pre><code>GET    /items/[collection]     # Lire tous les √©l√©ments
GET    /items/[collection]/[id] # Lire un √©l√©ment sp√©cifique
POST   /items/[collection]     # Cr√©er un nouvel √©l√©ment
PATCH  /items/[collection]/[id] # Modifier un √©l√©ment
DELETE /items/[collection]/[id] # Supprimer un √©l√©ment</code></pre>
            </div>

            <h3>Avantages de cette approche</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>‚úÖ Coh√©rence</h4>
                    <p>M√™me structure pour toutes les collections</p>
                </div>
                <div class="feature-card">
                    <h4>‚úÖ Pr√©visibilit√©</h4>
                    <p>Si vous connaissez le nom de la collection, vous connaissez l'API</p>
                </div>
                <div class="feature-card">
                    <h4>‚úÖ Flexibilit√©</h4>
                    <p>Param√®tres de requ√™te puissants (filtres, relations, tri)</p>
                </div>
                <div class="feature-card">
                    <h4>‚úÖ Performance</h4>
                    <p>Optimisations automatiques des requ√™tes SQL</p>
                </div>
            </div>

            <h3>M√©thodologie de test progressive</h3>

            <h4>Phase 1 : Tests basiques (Collections isol√©es)</h4>
            <div class="alert info">
                <strong>üéØ Objectif</strong> : Valider que chaque collection fonctionne ind√©pendamment
                <ol>
                    <li><strong>Tags</strong> (le plus simple - pas de relations)</li>
                    <li><strong>Files</strong> (upload et transformations)</li>
                    <li><strong>Users</strong> (authentification)</li>
                </ol>
            </div>

            <h4>Phase 2 : Tests relationnels</h4>
            <div class="alert warning">
                <strong>üéØ Objectif</strong> : Valider les relations entre collections
                <ol>
                    <li><strong>Memes ‚Üí Files</strong> (relation simple M2O)</li>
                    <li><strong>Memes ‚Üí Tags</strong> (relation complexe M2M)</li>
                    <li><strong>Users ‚Üí Memes</strong> (relation avec authentification)</li>
                </ol>
            </div>

            <h4>Phase 3 : Tests de workflows complets</h4>
            <div class="alert success">
                <strong>üéØ Objectif</strong> : Valider des sc√©narios utilisateur r√©els
                <ol>
                    <li><strong>Cr√©ation compl√®te d'un meme</strong> (upload + tags + publication)</li>
                    <li><strong>Interactions sociales</strong> (likes, consultation)</li>
                    <li><strong>Gestion des permissions</strong> (public vs authentifi√©)</li>
                </ol>
            </div>

            <h3>Workflows de test complets</h3>

            <h4>üéØ Sc√©nario 1 : Utilisateur cr√©e son premier meme</h4>
            <ol>
                <li><strong>Authentification</strong> ‚Üí r√©cup√©rer le token JWT</li>
                <li><strong>Upload image</strong> ‚Üí r√©cup√©rer l'UUID du fichier</li>
                <li><strong>Cr√©er tags</strong> (si nouveaux) ‚Üí r√©cup√©rer les UUIDs</li>
                <li><strong>Cr√©er meme</strong> avec image et tags</li>
                <li><strong>V√©rifier</strong> avec GET /items/memes</li>
            </ol>

            <h4>üéØ Sc√©nario 2 : Interaction sociale (likes)</h4>
            <ol>
                <li><strong>Authentification</strong> utilisateur A</li>
                <li><strong>Liker un meme</strong> d'un autre utilisateur</li>
                <li><strong>V√©rifier</strong> le like avec GET /items/memes_likes</li>
                <li><strong>Authentification</strong> utilisateur B</li>
                <li><strong>Liker le m√™me meme</strong></li>
                <li><strong>Compter les likes</strong> du meme</li>
            </ol>

            <div class="alert success">
                <strong>‚úÖ Validation finale</strong>
                Avant de passer aux sections avanc√©es, v√©rifiez que tous les endpoints fonctionnent correctement dans votre outil de test (Insomnia/Postman).
            </div>
        </section>

        <section id="oauth" class="section">
            <h2>10. Configuration OAuth GitHub <span class="badge bonus">Bonus avanc√©</span></h2>

            <div class="alert info">
                <strong>üéØ Pourquoi OAuth avec GitHub ?</strong>
                L'authentification OAuth offre une exp√©rience utilisateur moderne et s√©curis√©e :
                <ul class="checklist">
                    <li>Simplicit√© utilisateur : Pas besoin de cr√©er un nouveau compte</li>
                    <li>S√©curit√© renforc√©e : GitHub g√®re l'authentification et les mots de passe</li>
                    <li>Donn√©es enrichies : Avatar, nom, email automatiquement r√©cup√©r√©s</li>
                    <li>Exp√©rience moderne : Standard des applications web actuelles</li>
                </ul>
            </div>

            <h3>Architecture OAuth GitHub + Directus</h3>
            <div class="code-block">
                <div class="code-header">Flux OAuth</div>
                <pre><code>1. Frontend ‚Üí Redirect GitHub OAuth
2. GitHub ‚Üí Code d'autorisation ‚Üí Frontend  
3. Frontend ‚Üí Code ‚Üí Directus
4. Directus ‚Üí Token GitHub ‚Üí Donn√©es utilisateur
5. Directus ‚Üí JWT Token ‚Üí Frontend (connect√©)</code></pre>
            </div>

            <h3>√âtape 1 : Configuration GitHub OAuth App</h3>
            <ol>
                <li>Se connecter √† GitHub et aller sur https://github.com/settings/developers</li>
                <li><strong>OAuth Apps</strong> ‚Üí <strong>New OAuth App</strong></li>
                <li>Remplir les informations :
                    <ul>
                        <li><strong>Application name</strong> : "Meme Manager - Development"</li>
                        <li><strong>Homepage URL</strong> : <code>http://localhost:4200</code></li>
                        <li><strong>Application description</strong> : "Application de gestion de memes pour le cours"</li>
                        <li><strong>Authorization callback URL</strong> : <code>http://localhost:8055/auth/login/github/callback</code></li>
                    </ul>
                </li>
                <li><strong>Register application</strong></li>
                <li>Noter les informations importantes :
                    <ul>
                        <li><strong>Client ID</strong> : (sera public c√¥t√© frontend)</li>
                        <li><strong>Client Secret</strong> : (garder secret c√¥t√© backend)</li>
                    </ul>
                </li>
            </ol>

            <h3>√âtape 2 : Configuration Directus</h3>
            <div class="code-block">
                <div class="code-header">Variables d'environnement .env</div>
                <pre><code># Configuration OAuth GitHub
AUTH_PROVIDERS="github"

AUTH_GITHUB_DRIVER="oauth2"
AUTH_GITHUB_CLIENT_ID="votre_client_id_github"
AUTH_GITHUB_CLIENT_SECRET="votre_client_secret_github"
AUTH_GITHUB_SCOPE="read:user user:email"

# URLs de redirection
AUTH_GITHUB_AUTHORIZE_URL="https://github.com/login/oauth/authorize"
AUTH_GITHUB_ACCESS_URL="https://github.com/login/oauth/access_token"
AUTH_GITHUB_PROFILE_URL="https://api.github.com/user"

# Configuration des champs utilisateur
AUTH_GITHUB_IDENTIFIER_KEY="id"
AUTH_GITHUB_EMAIL_KEY="email"
AUTH_GITHUB_FIRST_NAME_KEY="name"
AUTH_GITHUB_LAST_NAME_KEY=""
AUTH_GITHUB_AVATAR_KEY="avatar_url"

# Redirection apr√®s connexion
AUTH_GITHUB_REDIRECT_ALLOW_LIST="http://localhost:4200"</code></pre>
            </div>

            <h4>Red√©marrage de Directus</h4>
            <div class="code-block">
                <pre><code># Arr√™ter Directus (Ctrl+C)
# Puis relancer
npx directus start</code></pre>
            </div>

            <div class="alert warning">
                <strong>üîÑ Point de migration</strong>
                Apr√®s avoir configur√© OAuth, cr√©ez une nouvelle migration pour capturer ces modifications :
                <div class="code-block">
                    <pre><code>npx directus schema snapshot migrations/002_add_oauth_support.json
git add migrations/002_add_oauth_support.json  
git commit -m "feat: ajout support OAuth GitHub"</code></pre>
                </div>
            </div>

            <h3>Test OAuth avec Insomnia</h3>
            <div class="alert info">
                <strong>üìù Collection OAuth dans Insomnia</strong>
                Cr√©ez un nouveau dossier "üîê OAuth GitHub (Bonus)" avec ces requ√™tes :
            </div>

            <h4>Requ√™te 1 : URL de redirection GitHub</h4>
            <div class="code-block">
                <pre><code>GET {{ _.base_url }}/auth/github</code></pre>
            </div>

            <h4>Requ√™te 2 : Finalisation de la connexion</h4>
            <div class="code-block">
                <pre><code>POST {{ _.base_url }}/auth/login/github
Content-Type: application/json

{
  "code": "code_authorization_github"
}</code></pre>
            </div>

            <h4>Workflow OAuth complet</h4>
            <ol>
                <li><strong>Get GitHub Auth URL</strong> ‚Üí Copier l'URL d'autorisation</li>
                <li><strong>Navigateur</strong> ‚Üí Autoriser l'app ‚Üí Noter le code</li>
                <li><strong>Login with GitHub Code</strong> ‚Üí Recevoir le JWT token</li>
                <li><strong>Tester les permissions</strong> ‚Üí M√™me fonctionnalit√©s que l'auth classique</li>
            </ol>

            <div class="diagram">
                [Ins√©rer screenshot : Collection OAuth dans Insomnia]
            </div>
        </section>

        <section id="meilisearch" class="section">
            <h2>11. Recherche intelligente avec Meilisearch <span class="badge advanced">Avanc√©</span></h2>

            <div class="alert warning">
                <strong>‚ùå Limitations de la recherche Directus native</strong>
                <ul>
                    <li>Recherche uniquement par correspondance exacte</li>
                    <li>Pas de tol√©rance aux fautes de frappe</li>
                    <li>Pas de scoring de pertinence intelligent</li>
                    <li>Recherche lente sur de gros volumes</li>
                    <li>Pas de facettes avanc√©es</li>
                </ul>
            </div>

            <div class="alert success">
                <strong>‚úÖ Avantages Meilisearch</strong>
                <ul>
                    <li><strong>Recherche ultra-rapide</strong> (< 50ms m√™me avec millions de documents)</li>
                    <li><strong>Typo-tol√©rance</strong> automatique et intelligente</li>
                    <li><strong>Scoring de pertinence</strong> bas√© sur la popularit√©, les tags, etc.</li>
                    <li><strong>Facettes</strong> pour filtrer par tag, cr√©ateur, date</li>
                    <li><strong>Recherche multi-crit√®res</strong> (titre + description + tags)</li>
                    <li><strong>Analytics de recherche</strong> int√©gr√©es</li>
                </ul>
            </div>

            <h3>Architecture choisie : Proxy via Directus</h3>
            <div class="code-block">
                <pre><code>Frontend ‚Üí Directus Endpoints Custom ‚Üí Meilisearch ‚Üí R√©sultats</code></pre>
            </div>

            <h3>Installation Meilisearch</h3>
            <div class="code-block">
                <div class="code-header">Installation (Linux/macOS)</div>
                <pre><code># Installation via cURL
curl -L https://install.meilisearch.com | sh

# Rendre ex√©cutable et lancer
chmod +x meilisearch
./meilisearch --master-key="votre_cl√©_secr√®te_d√©veloppement"</code></pre>
            </div>

            <h3>Configuration Directus</h3>
            <div class="code-block">
                <div class="code-header">Variables d'environnement</div>
                <pre><code># Configuration Meilisearch
MEILISEARCH_HOST=http://localhost:7700
MEILISEARCH_API_KEY=votre_cl√©_secr√®te_d√©veloppement
MEILISEARCH_INDEX_MEMES=memes_index</code></pre>
            </div>

            <div class="code-block">
                <div class="code-header">Installation SDK</div>
                <pre><code>cd poc/directus-backend
npm install meilisearch</code></pre>
            </div>

            <h3>Synchronisation automatique avec Hooks</h3>
            <div class="alert info">
                <strong>üìÅ Cr√©er le fichier extensions/hooks/meilisearch-sync/index.js</strong>
                Ce hook synchronise automatiquement les memes avec Meilisearch lors de leur cr√©ation/modification.
            </div>

            <div class="code-block">
                <div class="code-header">Hook de synchronisation (extrait)</div>
                <pre><code>import { MeiliSearch } from 'meilisearch';

export default ({ action }, { env, logger }) => {
  const client = new MeiliSearch({
    host: env.MEILISEARCH_HOST || 'http://localhost:7700',
    apiKey: env.MEILISEARCH_API_KEY
  });
  
  const index = client.index(env.MEILISEARCH_INDEX_MEMES || 'memes_index');

  // Synchronisation lors de cr√©ation de meme
  action('items.create', async ({ collection, item, key }) => {
    if (collection !== 'memes') return;
    
    // Indexer le nouveau meme avec ses relations
    const searchDocument = {
      id: fullMeme.id,
      title: fullMeme.title,
      tags: fullMeme.tags?.map(t => t.tags_id.name) || [],
      // ... autres champs
    };
    
    await index.addDocuments([searchDocument]);
  });
};</code></pre>
            </div>

            <h3>Endpoints de recherche personnalis√©s</h3>
            <div class="alert info">
                <strong>üìÅ Cr√©er le fichier extensions/endpoints/search/index.js</strong>
                Ces endpoints exposent la recherche Meilisearch via l'API Directus.
            </div>

            <div class="code-block">
                <div class="code-header">Endpoint de recherche principal</div>
                <pre><code>export default (router, { env }) => {
  // Endpoint de recherche principal
  router.get('/memes', async (req, res) => {
    const { q, limit = 20, tags, sort } = req.query;
    
    const searchOptions = {
      limit: parseInt(limit),
      attributesToHighlight: ['title', 'text_top', 'text_bottom'],
      // Filtres et tri...
    };

    const results = await index.search(q || '', searchOptions);
    
    res.json({
      hits: results.hits,
      totalHits: results.estimatedTotalHits,
      processingTimeMs: results.processingTimeMs
    });
  });
};</code></pre>
            </div>

            <div class="alert warning">
                <strong>üîÑ Point de migration</strong>
                Apr√®s avoir ajout√© les extensions Meilisearch (hooks et endpoints), cr√©ez une migration :
                <div class="code-block">
                    <pre><code>npx directus schema snapshot migrations/003_add_meilisearch_extensions.json
git add migrations/003_add_meilisearch_extensions.json
git commit -m "feat: ajout extensions Meilisearch pour recherche avanc√©e"</code></pre>
                </div>
            </div>

            <h3>Test avec Insomnia</h3>
            <div class="alert success">
                <strong>üîç Dossier Search (Meilisearch)</strong>
                Cr√©ez ces requ√™tes dans Insomnia :
            </div>

            <div class="code-block">
                <div class="code-header">Requ√™tes de test</div>
                <pre><code># Recherche simple
GET {{ _.base_url }}/search/memes?q=drole programmation&limit=10

# Recherche avec filtres
GET {{ _.base_url }}/search/memes?q=bug&tags=programmation,humor&sort=likes_desc

# Autocompl√©tion
GET {{ _.base_url }}/search/memes/suggest?q=prog&limit=5</code></pre>
            </div>

            <h4>Test du workflow de recherche</h4>
            <ol>
                <li><strong>Cr√©er plusieurs memes</strong> avec des tags diff√©rents</li>
                <li><strong>Attendre la synchronisation</strong> automatique (hooks)</li>
                <li><strong>Tester la recherche typo-tol√©rante</strong> : "meem" trouve "meme"</li>
                <li><strong>Tester les filtres</strong> par tags</li>
                <li><strong>V√©rifier l'autocompl√©tion</strong></li>
                <li><strong>Analyser les facettes</strong> pour voir les tags populaires</li>
            </ol>
        </section>

        <section id="websockets" class="section">
            <h2>12. WebSockets et temps r√©el avec Directus <span class="badge advanced">Avanc√©</span></h2>

            <div class="alert info">
                <strong>üîÑ Directus Realtime</strong>
                Directus Realtime permet de recevoir des notifications en temps r√©el lorsque des donn√©es changent dans votre base de donn√©es.
            </div>

            <h3>Cas d'usage temps r√©el</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üîî Notifications instantan√©es</h4>
                    <p>Quand quelqu'un like votre meme</p>
                </div>
                <div class="feature-card">
                    <h4>üì± Feed en temps r√©el</h4>
                    <p>Nouveaux memes apparaissent automatiquement</p>
                </div>
                <div class="feature-card">
                    <h4>üìä Compteurs live</h4>
                    <p>Likes, vues, commentaires mis √† jour</p>
                </div>
                <div class="feature-card">
                    <h4>üë• Collaboration temps r√©el</h4>
                    <p>Plusieurs utilisateurs travaillent ensemble</p>
                </div>
            </div>

            <h3>Architecture WebSocket Directus</h3>
            <div class="code-block">
                <pre><code>Client (Frontend/Insomnia) 
    ‚Üï WebSocket Connection
Directus Server (:8055/websocket)
    ‚Üï Database Events  
SQLite Database</code></pre>
            </div>

            <h3>Configuration WebSockets</h3>
            <p>Les WebSockets sont <strong>activ√©s par d√©faut</strong> dans Directus v11.</p>
            <div class="alert success">
                <strong>üîó URL d'acc√®s</strong>
                <code>ws://localhost:8055/websocket</code>
            </div>

            <h4>Permissions pour les √©v√©nements temps r√©el</h4>
            <ol>
                <li>Settings ‚Üí <strong>Access Control</strong> ‚Üí <strong>Roles</strong></li>
                <li><strong>Authenticated User</strong> ‚Üí <strong>System Collections</strong></li>
                <li><strong>Directus Activity</strong> ‚Üí <strong>Read</strong> : ‚úÖ Activ√©</li>
                <li><strong>Directus Revisions</strong> ‚Üí <strong>Read</strong> : ‚úÖ Activ√© (optionnel)</li>
            </ol>

            <h3>Types d'√©v√©nements disponibles</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>√âv√©nements syst√®me</h4>
                    <ul>
                        <li><code>create</code> : Nouvel item cr√©√©</li>
                        <li><code>update</code> : Item modifi√©</li>
                        <li><code>delete</code> : Item supprim√©</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>Collections support√©es</h4>
                    <ul>
                        <li><code>items.memes</code> : √âv√©nements sur les memes</li>
                        <li><code>items.memes_likes</code> : √âv√©nements sur les likes</li>
                        <li><code>items.notifications</code> : √âv√©nements notifications</li>
                        <li><code>items.tags</code> : √âv√©nements sur les tags</li>
                    </ul>
                </div>
            </div>

            <h3>Test WebSocket avec Insomnia</h3>
            <div class="alert info">
                <strong>üîÑ Cr√©er une connexion WebSocket</strong>
                <ol>
                    <li><strong>New Request</strong> ‚Üí <strong>WebSocket Request</strong></li>
                    <li><strong>Name</strong> : "Directus Realtime Connection"</li>
                    <li><strong>URL</strong> : <code>ws://localhost:8055/websocket</code></li>
                    <li><strong>Headers</strong> : <code>Authorization: Bearer {{ _.token }}</code></li>
                </ol>
            </div>

            <h4>Messages de souscription</h4>
            <div class="code-block">
                <div class="code-header">Authentification WebSocket</div>
                <pre><code>{
  "type": "auth",
  "access_token": "your-jwt-token"
}</code></pre>
            </div>

            <div class="code-block">
                <div class="code-header">Souscription aux √©v√©nements</div>
                <pre><code>{
  "type": "subscribe",
  "collection": "memes",
  "query": {
    "fields": ["*", "user_created.first_name", "tags.tags_id.name"]
  }
}</code></pre>
            </div>

            <h4>Test du workflow temps r√©el</h4>
            <ol>
                <li><strong>Connexion WebSocket</strong> ‚Üí Message d'authentification</li>
                <li><strong>Souscription</strong> aux collections <code>memes</code> et <code>memes_likes</code></li>
                <li><strong>Dans un autre onglet REST</strong> : cr√©er un nouveau meme</li>
                <li><strong>Observer</strong> le message WebSocket temps r√©el re√ßu</li>
                <li><strong>Liker le meme</strong> via REST API</li>
                <li><strong>Voir</strong> la notification de like en temps r√©el</li>
            </ol>

            <h3>Automatisation des notifications</h3>
            <div class="alert warning">
                <strong>üìÅ Hook pour notifications automatiques</strong>
                Cr√©ez un hook dans <code>extensions/hooks/like-notification/index.js</code> pour automatiser la cr√©ation de notifications lors d'√©v√©nements.
            </div>

            <div class="code-block">
                <div class="code-header">Exemple de Hook basique</div>
                <pre><code>export default ({ action }) => {
  action('items.create', async ({ collection, item }) => {
    if (collection === 'memes_likes') {
      // Cr√©er une notification automatiquement
      await services.ItemsService('notifications').createOne({
        user_id: item.meme_owner_id,
        message: `Quelqu'un a lik√© votre meme !`,
        event_type: 'nouveau_like',
        meme_id: item.meme_id
      });
    }
  });
};</code></pre>
            </div>

            <div class="alert warning">
                <strong>üîÑ Point de migration</strong>
                Apr√®s avoir ajout√© des hooks WebSocket personnalis√©s, cr√©ez une migration :
                <div class="code-block">
                    <pre><code>npx directus schema snapshot migrations/004_add_websocket_hooks.json
git add migrations/004_add_websocket_hooks.json
git commit -m "feat: ajout hooks notifications temps r√©el"</code></pre>
                </div>
            </div>

            <h3>Collection Insomnia finale</h3>
            <div class="code-block">
                <div class="code-header">Structure compl√®te</div>
                <pre><code>üîê Authentification
üìÅ Files & Upload
üè∑Ô∏è Tags  
üé≠ Memes
‚ù§Ô∏è Likes
üîî Notifications
üîê OAuth GitHub (Bonus)
üîç Search (Meilisearch)
üîÑ WebSockets</code></pre>
            </div>
        </section>

        <div class="section">
            <h2>üéâ Conclusion</h2>
            
            <div class="alert success">
                <strong>‚úÖ F√©licitations !</strong>
                Vous avez cr√©√© un <strong>backend Directus complet et autonome</strong> pour votre application Meme Manager avec :
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üóÑÔ∏è Mod√®le de donn√©es robuste</h4>
                    <p>Relations utilisateurs, memes, tags et likes</p>
                </div>
                <div class="feature-card">
                    <h4>üîê Syst√®me d'authentification</h4>
                    <p>Int√©gr√© et s√©curis√© avec support OAuth</p>
                </div>
                <div class="feature-card">
                    <h4>üîå API REST compl√®te</h4>
                    <p>Test√©e et document√©e</p>
                </div>
                <div class="feature-card">
                    <h4>üñºÔ∏è Gestion avanc√©e des m√©dias</h4>
                    <p>Transformations automatiques</p>
                </div>
                <div class="feature-card">
                    <h4>üîí Permissions granulaires</h4>
                    <p>Diff√©rents types d'utilisateurs</p>
                </div>
                <div class="feature-card">
                    <h4>üîÑ Migrations versionn√©es</h4>
                    <p>Gestion professionnelle du sch√©ma</p>
                </div>
            </div>

            <h3>üîë Concepts backend ma√Ætris√©s</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Architecture API-First</h4>
                    <ul>
                        <li>S√©paration claire backend/frontend</li>
                        <li>API REST standardis√©e et pr√©visible</li>
                        <li>Authentification JWT stateless</li>
                        <li>Gestion des relations complexes (M2O, M2M)</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>S√©curit√© et permissions</h4>
                    <ul>
                        <li>Syst√®me de r√¥les et permissions</li>
                        <li>Validation automatique des donn√©es</li>
                        <li>Protection contre les acc√®s non autoris√©s</li>
                        <li>Isolation des donn√©es par utilisateur</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>Performance et optimisation</h4>
                    <ul>
                        <li>Transformations d'images √† la vol√©e</li>
                        <li>Relations optimis√©es (pas de N+1 queries)</li>
                        <li>Cache automatique des assets</li>
                        <li>Requ√™tes SQL optimis√©es par Directus</li>
                    </ul>
                </div>
            </div>

            <h3>üöÄ Votre API pr√™te pour le frontend</h3>
            <p>Votre backend Directus est maintenant <strong>pr√™t √† √™tre consomm√©</strong> par n'importe quel frontend :</p>
            <ul>
                <li><strong>Angular</strong> (cours suivant) üÖ∞Ô∏è</li>
                <li><strong>React</strong> ‚öõÔ∏è</li>
                <li><strong>Vue.js</strong> üü¢</li>
                <li><strong>Mobile</strong> (React Native, Flutter) üì±</li>
                <li><strong>Applications desktop</strong> üíª</li>
            </ul>
            <p><strong>L'avantage de cette approche : Un seul backend, plusieurs frontends possibles !</strong></p>

            <h3>üìã Checklist de validation finale</h3>
            <p>Avant de passer au frontend, v√©rifiez que :</p>
            <ul class="checklist">
                <li>Tous les endpoints API fonctionnent dans Insomnia/Postman</li>
                <li>L'authentification JWT marche correctement</li>
                <li>Les permissions respectent les r√®gles m√©tier</li>
                <li>Les uploads d'images et transformations sont op√©rationnels</li>
                <li>Les relations entre collections sont correctes</li>
                <li>L'interface admin permet de g√©rer le contenu facilement</li>
                <li><strong>Migrations cr√©√©es</strong> pour versioner votre sch√©ma de donn√©es</li>
            </ul>

            <h3>üéØ Prochaine √©tape : Frontend Angular</h3>
            <p>Dans le prochain cours, vous utiliserez cette API pour cr√©er une interface utilisateur moderne avec Angular, en vous connectant √† ce backend d√©j√† fonctionnel.</p>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>üìö Ressources utiles</h3>
                    <ul>
                        <li><a href="https://docs.directus.io">Documentation Directus</a></li>
                        <li><a href="https://docs.directus.io/reference/introduction">API Reference</a></li>
                        <li><a href="https://docs.directus.io/app/data-model/relationships">Guide des Relations</a></li>
                        <li><a href="https://docs.directus.io/configuration/users-roles-permissions">Syst√®me de Permissions</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>üîß Outils de test d'API</h3>
                    <ul>
                        <li><a href="https://insomnia.rest">Insomnia (recommand√©)</a></li>
                        <li><a href="https://postman.com">Postman</a></li>
                        <li><a href="#">Collections pr√©-faites Directus Community</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>üë• Communaut√© et support</h3>
                    <ul>
                        <li><a href="https://discord.gg/directus">Discord Directus</a></li>
                        <li><a href="https://github.com/directus/directus">GitHub</a></li>
                        <li><a href="https://github.com/directus/examples">Examples</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>